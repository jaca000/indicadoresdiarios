<!doctype html>
<html lang="pt-PT">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Monte do Pasto · Painel Vivo</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
html,body{height:100%}

:root{
  --g1:#4f8f6b;
  --g2:#2f6b4f;
  --b1:#7b6445;

  --glass:rgba(255,255,255,.18);
  --glass2:rgba(0,0,0,.10);
  --stroke:rgba(255,255,255,.20);

  --t1:#f4f6f3;
  --t2:rgba(244,246,243,.78);
  --good:#7fd18c;
  --bad:#d1b27f;
}

body{
  margin:0;
  font-family:Inter,system-ui;
  color:var(--t1);
  overflow:hidden;
  transition:background 12s ease;

  background:
    radial-gradient(1100px 700px at 20% 15%, rgba(255,255,255,.22), transparent 58%),
    radial-gradient(900px 600px at 80% 25%, rgba(200,160,110,.20), transparent 60%),
    radial-gradient(1100px 800px at 60% 90%, rgba(140,220,180,.25), transparent 66%),
    linear-gradient(135deg,var(--g1),var(--g2) 55%,var(--b1));
}

/* FX */
#fx{position:fixed;inset:0;pointer-events:none;z-index:0}
.drop{
  position:absolute;width:2px;height:18px;
  background:rgba(230,245,255,.6);
  border-radius:999px;
  animation:fall linear infinite;
}
@keyframes fall{from{transform:translateY(-120px)}to{transform:translateY(110vh)}}
.fog{
  position:absolute;inset:-20%;
  background:
    radial-gradient(circle at 30% 50%, rgba(255,255,255,.20), transparent 55%),
    radial-gradient(circle at 70% 60%, rgba(255,255,255,.16), transparent 60%);
  animation:fogmove 120s linear infinite;
}
@keyframes fogmove{from{transform:translateX(0)}to{transform:translateX(-14%)}}
.sunGlow{
  position:absolute;top:10%;right:12%;
  border-radius:50%;
  background:radial-gradient(circle,
    rgba(255,230,170,.95),
    rgba(255,210,150,.35),
    transparent 66%);
  animation:sunpulse 7s ease-in-out infinite;
}
@keyframes sunpulse{0%,100%{transform:scale(.95);opacity:.8}50%{transform:scale(1.03);opacity:1}}

.app{
  position:relative;z-index:1;
  height:100vh;
  display:grid;
  grid-template-rows:100px 1fr 56px;
}

header{
  padding:0 28px;
  display:flex;align-items:center;gap:16px;
}
.header-left{display:flex;align-items:center;gap:16px;min-width:340px}
.logo{height:48px}

.now{
  display:flex;gap:10px;align-items:center;
  padding:10px 14px;border-radius:18px;
  background:linear-gradient(180deg,var(--glass),var(--glass2));
  border:1px solid var(--stroke);
}
.now .temp{font-size:20px;font-weight:800}
.now .desc{font-size:14px;color:var(--t2)}

.header-mid{flex:1;display:flex;justify-content:center;gap:14px}
.group{
  display:flex;align-items:center;gap:10px;
  padding:10px 14px;border-radius:18px;
  background:linear-gradient(180deg,rgba(255,255,255,.16),rgba(0,0,0,.10));
  border:1px solid var(--stroke);
}
.group .title{font-size:12px;text-transform:uppercase;color:var(--t2)}
.pills{display:flex;gap:10px}
.pill{
  display:flex;gap:8px;align-items:center;
  padding:8px 10px;border-radius:14px;
  background:rgba(255,255,255,.22);
  border:1px solid rgba(255,255,255,.18);
  min-width:100px;
}
.small{font-size:14px;font-weight:800}
.sub{font-size:12px;color:var(--t2)}

.clock{min-width:90px;text-align:right;font-size:30px;font-weight:800}

main{
  padding:24px 28px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:22px;
}

.card{
  background:linear-gradient(180deg,rgba(255,255,255,.18),rgba(0,0,0,.10));
  border:1px solid var(--stroke);
  border-radius:26px;
  padding:22px;
}

.card h3{
  margin:0 0 14px;
  font-size:13px;text-transform:uppercase;color:var(--t2);
}

.kpi{
  font-size:64px;font-weight:900;
}
.kpi span{font-size:18px;color:var(--t2)}

.kpi-sub{
  margin-top:8px;
  font-size:18px;
}
.kpi-sub.good{color:var(--good)}
.kpi-sub.bad{color:var(--bad)}

footer{
  padding:0 28px;
  display:flex;align-items:center;
  color:var(--t2);font-size:14px;
}
</style>
</head>

<body>
<div id="fx"></div>

<div class="app">
<header>
  <div class="header-left">
    <img class="logo" src="assets/logo-monte-do-pasto.png">
    <div class="now">
      <div>
        <div class="temp" id="nowTemp">--°C</div>
        <div class="desc" id="nowDesc">---</div>
      </div>
    </div>
  </div>

  <div class="header-mid">
    <div class="group">
      <div class="title">Próx. horas</div>
      <div class="pills" id="hoursPills"></div>
    </div>
    <div class="group">
      <div class="title">Próx. dias</div>
      <div class="pills" id="daysPills"></div>
    </div>
  </div>

  <div class="clock" id="clock">--:--</div>
</header>

<main>
  <div class="card">
    <h3>Chuva acumulada desde 1 de Janeiro</h3>
    <div class="kpi" id="rainNow">-- <span>L/m²</span></div>
    <div class="kpi-sub" id="rainDiff">--</div>
  </div>

  <div class="card">
    <h3>Avisos</h3>
    <div>Ambiente monitorizado em tempo real</div>
  </div>
</main>

<footer>Informação interna · Monte do Pasto</footer>
</div>

<script>
/* RELÓGIO */
function tick(){
  clock.textContent=new Intl.DateTimeFormat("pt-PT",{hour:"2-digit",minute:"2-digit"}).format(new Date());
}
tick(); setInterval(tick,30000);

/* COORDENADAS */
const LAT=38.219, LON=-7.887;

/* === KPI CHUVA ACUMULADA === */
async function updateRainKPI(){
  const today=new Date();
  const yyyy=today.getFullYear();
  const mm=String(today.getMonth()+1).padStart(2,"0");
  const dd=String(today.getDate()).padStart(2,"0");

  const startThis=`${yyyy}-01-01`;
  const startLast=`${yyyy-1}-01-01`;
  const endToday=`${yyyy}-${mm}-${dd}`;
  const endLast=`${yyyy-1}-${mm}-${dd}`;

  const url=(s,e)=>`https://archive-api.open-meteo.com/v1/archive?latitude=${LAT}&longitude=${LON}&daily=precipitation_sum&start_date=${s}&end_date=${e}&timezone=auto`;

  const [cur,prev]=await Promise.all([
    fetch(url(startThis,endToday)).then(r=>r.json()),
    fetch(url(startLast,endLast)).then(r=>r.json())
  ]);

  const sum=a=>a.reduce((t,v)=>t+(v||0),0);

  const now=sum(cur.daily.precipitation_sum);
  const last=sum(prev.daily.precipitation_sum);
  const diff=now-last;

  rainNow.textContent=`${Math.round(now)} `;
  rainDiff.textContent=`${diff>=0?"+":""}${Math.round(diff)} L/m² vs ${yyyy-1}`;
  rainDiff.className="kpi-sub "+(diff>=0?"good":"bad");
}

/* ATUALIZAÇÃO HORÁRIA */
updateRainKPI();
setInterval(updateRainKPI,60*60*1000);
</script>
</body>
</html>
