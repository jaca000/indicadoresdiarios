<!doctype html>
<html lang="pt-PT">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Monte do Pasto · Painel Vivo</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
html,body{height:100%}

:root{
  /* base Monte do Pasto (verde orgânico) */
  --bg1:#0e2a1d;
  --bg2:#103322;
  --bg3:#0f241a;
  --card:rgba(255,255,255,.08);
  --card2:rgba(0,0,0,.18);
  --stroke:rgba(255,255,255,.10);
  --text:#f3f6f4;
  --muted:rgba(243,246,244,.75);
  --pill:rgba(255,255,255,.10);
}

body{
  margin:0;
  font-family:Inter,system-ui;
  color:var(--text);
  overflow:hidden;
  /* NUNCA PRETO: gradiente verde */
  background:
    radial-gradient(1200px 700px at 20% 20%, rgba(120,255,190,.16), transparent 55%),
    radial-gradient(900px 600px at 80% 30%, rgba(255,220,150,.12), transparent 55%),
    radial-gradient(1100px 800px at 60% 90%, rgba(80,200,140,.14), transparent 60%),
    linear-gradient(135deg, var(--bg1), var(--bg2) 55%, var(--bg3));
}

/* grain suave para “vida” */
body::before{
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
  opacity:.10;
  background-image:
    repeating-linear-gradient(0deg, rgba(255,255,255,.05) 0px, rgba(255,255,255,.05) 1px, transparent 1px, transparent 6px),
    repeating-linear-gradient(90deg, rgba(0,0,0,.04) 0px, rgba(0,0,0,.04) 1px, transparent 1px, transparent 7px);
  mix-blend-mode:overlay;
}

/* FX layer (chuva/nevoeiro/sol/neve) */
#fx{position:fixed;inset:0;pointer-events:none;z-index:0}

/* chuva (gotas) */
.drop{
  position:absolute;
  width:2px;height:16px;
  background:rgba(210,240,255,.45);
  border-radius:50%;
  animation:fall linear infinite;
}
@keyframes fall{
  from{transform:translateY(-120px) translateX(0)}
  to{transform:translateY(110vh) translateX(40px)}
}

/* flocos */
.flake{
  position:absolute;
  width:4px;height:4px;
  background:rgba(240,250,255,.8);
  border-radius:50%;
  animation:snow linear infinite;
}
@keyframes snow{
  from{transform:translateY(-40px) translateX(0)}
  to{transform:translateY(110vh) translateX(60px)}
}

/* nevoeiro */
.fog{
  position:absolute;
  inset:-20%;
  background:
    radial-gradient(circle at 30% 50%, rgba(255,255,255,.16), transparent 55%),
    radial-gradient(circle at 70% 60%, rgba(255,255,255,.12), transparent 60%);
  animation:fogmove 110s linear infinite;
  opacity:.55;
}
@keyframes fogmove{
  from{transform:translateX(0)}
  to{transform:translateX(-14%)}
}

/* sol brilho */
.sun-glow{
  position:absolute;
  top:10%;
  right:12%;
  border-radius:50%;
  background:radial-gradient(circle,
    rgba(255,220,150,.95),
    rgba(255,220,150,.35),
    transparent 65%);
  animation:sunpulse 7s ease-in-out infinite;
}
@keyframes sunpulse{
  0%,100%{transform:scale(.95);opacity:.75}
  50%{transform:scale(1.03);opacity:1}
}

/* =========================
   APP LAYOUT
   ========================= */
.app{
  position:relative;
  z-index:1;
  height:100vh;
  display:grid;
  grid-template-rows:88px 1fr 64px;
}

/* HEADER BAR (com tudo) */
header{
  padding:0 28px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:18px;
}

.header-left{
  display:flex;
  align-items:center;
  gap:14px;
  min-width:280px;
}

.logo{
  height:38px;
  filter:drop-shadow(0 10px 20px rgba(0,0,0,.35));
}

/* bloco tempo atual */
.now{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 14px;
  border-radius:18px;
  background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.10));
  border:1px solid var(--stroke);
  backdrop-filter: blur(10px);
}

.now .temp{font-size:20px;font-weight:700}
.now .desc{font-size:14px;color:var(--muted)}

/* pills horas/dias no header */
.header-mid{
  flex:1;
  display:flex;
  align-items:center;
  gap:14px;
  justify-content:center;
}

.group{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 14px;
  border-radius:18px;
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.10));
  border:1px solid var(--stroke);
  backdrop-filter: blur(10px);
}

.group .title{
  font-size:12px;
  letter-spacing:.8px;
  text-transform:uppercase;
  color:var(--muted);
  margin-right:6px;
  white-space:nowrap;
}

.pills{display:flex;gap:10px;align-items:center}

.pill{
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  border-radius:14px;
  background:var(--pill);
  border:1px solid rgba(255,255,255,.08);
  min-width:86px;
  justify-content:center;
}

.pill .small{font-size:14px;font-weight:700}
.pill .sub{font-size:12px;color:var(--muted)}

/* relógio */
.clock{
  min-width:90px;
  text-align:right;
  font-size:30px;
  font-weight:700;
  text-shadow:0 12px 24px rgba(0,0,0,.35);
}

/* MAIN */
main{
  padding:26px 28px 18px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:22px;
}

.card{
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.12));
  border:1px solid var(--stroke);
  border-radius:26px;
  padding:22px;
  backdrop-filter: blur(10px);
  box-shadow:0 30px 70px rgba(0,0,0,.30);
}

.card h3{
  margin:0 0 14px;
  font-size:13px;
  letter-spacing:.8px;
  text-transform:uppercase;
  color:var(--muted);
}

/* KPI */
.kpi{
  font-size:64px;
  font-weight:800;
  letter-spacing:-1px;
}
.kpi span{
  font-size:18px;
  color:var(--muted);
  font-weight:600;
}

/* Avisos */
.notice{
  font-size:22px;
  line-height:1.35;
  color:rgba(243,246,244,.92);
}

/* FOOTER */
footer{
  padding:0 28px;
  display:flex;
  align-items:center;
  color:rgba(243,246,244,.60);
  font-size:14px;
}

/* =========================
   ÍCONES (CSS) — REAIS
   ========================= */
.icon{position:relative;width:26px;height:26px;flex:0 0 26px}

/* sol */
.icon.sun::before{
  content:"";
  position:absolute;inset:5px;
  border-radius:50%;
  background:radial-gradient(circle, rgba(255,230,160,1), rgba(255,190,110,1));
  box-shadow:0 0 18px rgba(255,220,150,.35);
  animation:sunMini 3.8s ease-in-out infinite;
}
@keyframes sunMini{
  0%,100%{transform:scale(.92);opacity:.85}
  50%{transform:scale(1.02);opacity:1}
}

/* nuvem */
.icon.cloud::before{
  content:"";
  position:absolute;left:3px;right:3px;bottom:6px;height:12px;
  background:rgba(255,255,255,.85);
  border-radius:12px;
  opacity:.85;
}
.icon.cloud::after{
  content:"";
  position:absolute;left:6px;bottom:10px;width:12px;height:12px;
  background:rgba(255,255,255,.85);
  border-radius:50%;
  box-shadow:10px -2px 0 rgba(255,255,255,.85);
  animation:cloudMini 6s ease-in-out infinite;
}
@keyframes cloudMini{
  0%,100%{transform:translateX(0)}
  50%{transform:translateX(4px)}
}

/* chuva */
.icon.rain::before{
  content:"";
  position:absolute;left:3px;right:3px;bottom:10px;height:10px;
  background:rgba(255,255,255,.88);
  border-radius:12px;
  opacity:.85;
}
.icon.rain::after{
  content:"";
  position:absolute;left:6px;top:14px;width:14px;height:14px;
  background:
    linear-gradient(transparent 0 0),
    radial-gradient(circle, rgba(160,220,255,.95) 2px, transparent 3px);
  background-size: 1px 1px, 8px 8px;
  background-position: 0 0, 0 0;
  animation:rainMini 1.1s linear infinite;
  opacity:.9;
}
@keyframes rainMini{
  from{transform:translateY(-2px);opacity:.9}
  to{transform:translateY(4px);opacity:.5}
}

/* neve */
.icon.snow::before{
  content:"";
  position:absolute;left:3px;right:3px;bottom:10px;height:10px;
  background:rgba(255,255,255,.88);
  border-radius:12px;
  opacity:.85;
}
.icon.snow::after{
  content:"";
  position:absolute;left:6px;top:15px;width:14px;height:14px;
  background:
    radial-gradient(circle, rgba(240,250,255,.95) 2px, transparent 3px);
  background-size:7px 7px;
  animation:snowMini 2.2s linear infinite;
  opacity:.95;
}
@keyframes snowMini{
  from{transform:translateY(-2px)}
  to{transform:translateY(5px)}
}
</style>
</head>

<body>
<div id="fx"></div>

<div class="app">
  <header>
    <div class="header-left">
      <img class="logo" src="assets/logo-monte-do-pasto.png" alt="Monte do Pasto">
      <div class="now">
        <div id="nowIcon" class="icon cloud"></div>
        <div>
          <div class="temp"><span id="nowTemp">--°C</span></div>
          <div class="desc" id="nowDesc">---</div>
        </div>
      </div>
    </div>

    <div class="header-mid">
      <div class="group">
        <div class="title">Próx. horas</div>
        <div class="pills" id="hoursPills"></div>
      </div>
      <div class="group">
        <div class="title">Próx. dias</div>
        <div class="pills" id="daysPills"></div>
      </div>
    </div>

    <div class="clock" id="clock">--:--</div>
  </header>

  <main>
    <div class="card">
      <h3>Indicador</h3>
      <div class="kpi">1280 <span>kg</span></div>
    </div>

    <div class="card">
      <h3>Avisos</h3>
      <div class="notice" id="notice">Ambiente monitorizado em tempo real</div>
    </div>
  </main>

  <footer>Informação interna · Monte do Pasto</footer>
</div>

<script>
/* relógio */
function tick(){
  clock.textContent = new Intl.DateTimeFormat("pt-PT",{hour:"2-digit",minute:"2-digit"}).format(new Date());
}
tick(); setInterval(tick, 30000);

/* helpers */
const dias = ["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"];

function iconClassFrom(code, temp){
  // Open-Meteo weathercode (simplificado)
  if(temp <= 1) return "snow";
  if([51,53,55,61,63,65,80,81,82,95,96,99].includes(code)) return "rain";
  if(code === 0) return "sun";
  // 1-3 e 45-48 = nublado/nevoeiro
  return "cloud";
}

/* FX baseline (nunca vazio, nunca preto) */
const fx = document.getElementById("fx");
function clearFX(){ fx.innerHTML=""; }

function rainFX(intensity){ // 0..1
  const drops = Math.floor(30 + intensity * 220);
  for(let i=0;i<drops;i++){
    const d=document.createElement("div");
    d.className="drop";
    d.style.left = Math.random()*100+"%";
    d.style.animationDuration = (0.6 + Math.random()*1.2 - intensity*0.25) + "s";
    d.style.opacity = 0.25 + Math.random()*0.45;
    d.style.height = (12 + Math.random()*18 + intensity*8) + "px";
    fx.appendChild(d);
  }
}

function fogFX(intensity){
  const f=document.createElement("div");
  f.className="fog";
  f.style.opacity = 0.35 + intensity*0.45;
  fx.appendChild(f);
}

function sunFX(intensity){
  const s=document.createElement("div");
  s.className="sun-glow";
  const size = 240 + intensity*220;
  s.style.width = s.style.height = size + "px";
  s.style.opacity = 0.35 + intensity*0.55;
  fx.appendChild(s);
}

function snowFX(intensity){
  const flakes = Math.floor(18 + intensity*120);
  for(let i=0;i<flakes;i++){
    const f=document.createElement("div");
    f.className="flake";
    f.style.left = Math.random()*100+"%";
    f.style.animationDuration = (3.0 + Math.random()*4.0 - intensity*1.0) + "s";
    f.style.opacity = 0.25 + Math.random()*0.55;
    f.style.width = f.style.height = (2 + Math.random()*4) + "px";
    fx.appendChild(f);
  }
}

/* fetch */
fetch("https://api.open-meteo.com/v1/forecast?latitude=38.219&longitude=-7.887&current_weather=true&hourly=temperature_2m,precipitation,weathercode&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto")
.then(r=>r.json())
.then(d=>{
  const cw = d.current_weather;
  const nowT = Math.round(cw.temperature);
  const nowCode = cw.weathercode;

  nowTemp.textContent = nowT + "°C";

  // descrição simples
  let desc = "Nublado";
  if(nowCode === 0) desc = "Sol";
  if([51,53,55,61,63,65,80,81,82,95,96,99].includes(nowCode)) desc = "Chuva";
  if(nowT <= 1) desc = "Frio";
  nowDesc.textContent = desc;

  // ícone header
  const ic = iconClassFrom(nowCode, nowT);
  nowIcon.className = "icon " + ic;

  // FX proporcional (precipitação horária agora)
  clearFX();
  const rain = d.hourly.precipitation[0] ?? 0;
  const intensityRain = Math.max(0, Math.min(1, rain/4)); // 0..4mm/h
  const intensityCloud = (ic === "cloud") ? 0.8 : 0.35;
  const intensitySun = (ic === "sun") ? 0.9 : 0.35;
  const intensitySnow = (ic === "snow") ? 0.9 : 0.2;

  // baseline sempre com “vida”, mas dominância pelo estado
  fogFX(0.35);

  if(ic === "rain") rainFX(intensityRain);
  if(ic === "sun")  sunFX(intensitySun);
  if(ic === "cloud") fogFX(intensityCloud);
  if(ic === "snow") snowFX(intensitySnow);

  // pills próximas horas (4)
  hoursPills.innerHTML = "";
  const now = new Date();
  for(let i=1;i<=4;i++){
    const t = Math.round(d.hourly.temperature_2m[i]);
    const c = d.hourly.weathercode[i];
    const dt = new Date(d.hourly.time[i]);
    const h = dt.getHours().toString().padStart(2,"0") + "h";
    const icH = iconClassFrom(c, t);
    hoursPills.innerHTML += `
      <div class="pill">
        <div class="icon ${icH}"></div>
        <div>
          <div class="small">${t}°</div>
          <div class="sub">${h}</div>
        </div>
      </div>`;
  }

  // pills próximos dias (4)
  daysPills.innerHTML = "";
  for(let i=1;i<=4;i++){
    const tmax = Math.round(d.daily.temperature_2m_max[i]);
    const tmin = Math.round(d.daily.temperature_2m_min[i]);
    const c = d.daily.weathercode[i];
    const date = new Date(d.daily.time[i]);
    const wd = dias[date.getDay()];
    const icD = iconClassFrom(c, tmin);
    daysPills.innerHTML += `
      <div class="pill">
        <div class="icon ${icD}"></div>
        <div>
          <div class="small">${tmax}°/${tmin}°</div>
          <div class="sub">${wd}</div>
        </div>
      </div>`;
  }
})
.catch(()=>{
  nowDesc.textContent = "Sem dados";
  nowIcon.className = "icon cloud";
  // FX baseline só para não ficar morto
  fogFX(0.5);
});
</script>
</body>
</html>
