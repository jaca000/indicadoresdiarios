<!doctype html>
<html lang="pt-PT">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Monte do Pasto · Painel Vivo</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
/* ================= RESET ================= */
*{box-sizing:border-box}
html,body{height:100%;margin:0}

/* ================= VARS ================= */
:root{
  --g1:#6fa98c;
  --g2:#4f7f63;
  --b1:#7b6445;

  --glass:rgba(255,255,255,.18);
  --glass2:rgba(0,0,0,.10);
  --stroke:rgba(255,255,255,.22);

  --t1:#f4f6f3;
  --t2:rgba(244,246,243,.78);
  --t3:rgba(244,246,243,.60);

  --good:#7fd18c;
  --bad:#d1b27f;

  --r1:18px;
  --r2:26px;
}

/* ================= BODY ================= */
body{
  font-family:Inter,system-ui,Arial;
  color:var(--t1);
  overflow:hidden;
  background:
    radial-gradient(1200px 800px at 20% 10%, rgba(255,255,255,.20), transparent 60%),
    radial-gradient(900px 700px at 80% 20%, rgba(200,160,110,.18), transparent 60%),
    radial-gradient(1200px 900px at 60% 90%, rgba(140,220,180,.25), transparent 65%),
    linear-gradient(135deg,var(--g1),var(--g2) 55%,var(--b1));
}

/* ================= FX ================= */
#fx{position:fixed;inset:0;pointer-events:none;z-index:0}

.drop{
  position:absolute;width:2px;height:18px;
  background:rgba(230,245,255,.6);
  animation:fall linear infinite;
}
@keyframes fall{from{transform:translateY(-100px)}to{transform:translateY(110vh)}}

.fog{
  position:absolute;inset:-20%;
  background:
    radial-gradient(circle at 30% 50%, rgba(255,255,255,.18), transparent 55%),
    radial-gradient(circle at 70% 60%, rgba(255,255,255,.14), transparent 60%);
  animation:fogmove 120s linear infinite;
}
@keyframes fogmove{from{transform:translateX(0)}to{transform:translateX(-14%)}}

.sun{
  position:absolute;top:8%;right:12%;
  width:300px;height:300px;border-radius:50%;
  background:radial-gradient(circle,rgba(255,230,170,.9),rgba(255,210,150,.35),transparent 65%);
  animation:sunpulse 6s ease-in-out infinite;
}
@keyframes sunpulse{0%,100%{transform:scale(.95)}50%{transform:scale(1.05)}}

/* ================= APP ================= */
.app{
  position:relative;
  z-index:1;
  height:100vh;
  display:grid;
  grid-template-rows:96px 1fr 48px;
}

/* ================= HEADER ================= */
header{
  padding:0 28px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}

.header-left{
  display:flex;
  align-items:center;
  gap:16px;
}

.logo{
  height:52px;
}

.now{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 14px;
  border-radius:var(--r1);
  background:linear-gradient(180deg,var(--glass),var(--glass2));
  border:1px solid var(--stroke);
}

.now .temp{font-size:20px;font-weight:800}
.now .desc{font-size:14px;color:var(--t2)}

.header-mid{
  display:flex;
  gap:16px;
}

.group{
  display:flex;
  gap:10px;
  padding:10px 14px;
  border-radius:var(--r1);
  background:linear-gradient(180deg,var(--glass),var(--glass2));
  border:1px solid var(--stroke);
}

.group-title{
  font-size:12px;
  text-transform:uppercase;
  color:var(--t2);
}

.pills{display:flex;gap:10px}

.pill{
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  border-radius:14px;
  background:rgba(255,255,255,.22);
}

.clock{
  font-size:30px;
  font-weight:800;
}

/* ================= MAIN ================= */
main{
  padding:22px 28px;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:22px;
  align-items:start;
}

.card{
  background:linear-gradient(180deg,var(--glass),var(--glass2));
  border:1px solid var(--stroke);
  border-radius:var(--r2);
  padding:18px 20px;
  transition:opacity .4s, transform .4s;
}

.card.hidden{
  opacity:0;
  transform:translateY(10px);
  pointer-events:none;
}

.card h3{
  margin:0 0 10px;
  font-size:13px;
  text-transform:uppercase;
  color:var(--t2);
}

.kpi{
  font-size:56px;
  font-weight:900;
}
.kpi span{font-size:18px;color:var(--t2)}

.kpi-sub{
  margin-top:8px;
  font-size:18px;
}

.kpi-image img{
  width:100%;
  max-height:280px;
  object-fit:contain;
  border-radius:14px;
  background:rgba(0,0,0,.1);
}

/* ================= FOOTER ================= */
footer{
  padding:0 28px;
  display:flex;
  align-items:center;
  color:var(--t2);
  font-size:14px;
}
</style>
</head>

<body>
<div id="fx"></div>

<div class="app">
  <header>
    <div class="header-left">
      <img class="logo" src="assets/logo-monte-do-pasto.png">
      <div class="now">
        <div>
          <div class="temp" id="nowTemp">--°C</div>
          <div class="desc" id="nowDesc">---</div>
        </div>
      </div>
    </div>

    <div class="header-mid">
      <div class="group">
        <div class="group-title">Próx. horas</div>
        <div class="pills" id="hours"></div>
      </div>
      <div class="group">
        <div class="group-title">Próx. dias</div>
        <div class="pills" id="days"></div>
      </div>
    </div>

    <div class="clock" id="clock">--:--</div>
  </header>

  <main id="kpis"></main>

  <footer>Informação interna · Monte do Pasto</footer>
</div>

<script>
/* ================= CONFIG ================= */
var LAT=38.219, LON=-7.887;
var SHEET_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vRcoOLTXvKf6K_4aejdyA7ZK6PObIzqyiLBBOPSehdSkKlxj9_ms0EqJOjT7u2lN11j5DaYIAkcqoy7/pub?output=csv";
var MAX_VISIBLE=6;
var ROTATE_MS=15000;

/* ================= CLOCK ================= */
function tick(){
  var d=new Date();
  clock.textContent=("0"+d.getHours()).slice(-2)+":"+("0"+d.getMinutes()).slice(-2);
}
tick(); setInterval(tick,30000);

/* ================= CSV PARSER ================= */
function parseCSV(t){
  var l=t.trim().split("\n");
  var h=l.shift().split(",");
  var o=[];
  for(var i=0;i<l.length;i++){
    var c=l[i].split(",");
    var r={};
    for(var j=0;j<h.length;j++) r[h[j]]=c[j]||"";
    o.push(r);
  }
  return o;
}

/* ================= WEATHER ================= */
function weather(){
  fetch("https://api.open-meteo.com/v1/forecast?latitude="+LAT+"&longitude="+LON+"&current_weather=true&hourly=temperature_2m,precipitation&daily=temperature_2m_max,temperature_2m_min&timezone=auto")
  .then(r=>r.json())
  .then(d=>{
    nowTemp.textContent=Math.round(d.current_weather.temperature)+"°C";
    nowDesc.textContent=d.current_weather.precipitation>0?"Chuva":"Nublado";

    hours.innerHTML="";
    for(var i=1;i<=4;i++){
      hours.innerHTML+=
        "<div class='pill'>"+Math.round(d.hourly.temperature_2m[i])+"°</div>";
    }

    days.innerHTML="";
    for(var i=1;i<=4;i++){
      days.innerHTML+=
        "<div class='pill'>"+Math.round(d.daily.temperature_2m_max[i])+"°/"+Math.round(d.daily.temperature_2m_min[i])+"°</div>";
    }

    fx.innerHTML="";
    if(d.current_weather.precipitation>0){
      for(var i=0;i<120;i++){
        var e=document.createElement("div");
        e.className="drop";
        e.style.left=Math.random()*100+"%";
        e.style.animationDuration=(0.6+Math.random())+"s";
        fx.appendChild(e);
      }
    } else {
      fx.innerHTML="<div class='sun'></div>";
    }
  });
}

/* ================= KPIs ================= */
var page=0, cards=[];
function loadKPIs(){
  fetch(SHEET_URL,{cache:"no-store"})
  .then(r=>r.text())
  .then(t=>{
    var rows=parseCSV(t).filter(r=>r.active==="TRUE");
    rows.sort((a,b)=>(a.order||999)-(b.order||999));

    kpis.innerHTML="";
    rows.forEach(r=>{
      var body="";
      if(r.type==="image") body="<div class='kpi-image'><img src='"+r.imageUrl+"'></div>";
      if(r.type==="number") body="<div class='kpi'>"+r.value+" <span>"+r.unit+"</span></div>";
      if(r.type==="text") body="<div class='kpi-sub'>"+r.value+"</div>";

      kpis.innerHTML+=
        "<div class='card kpi-card'><h3>"+r.title+"</h3>"+body+"</div>";
    });

    cards=[].slice.call(document.querySelectorAll(".kpi-card"));
    rotate();
    setInterval(rotate,ROTATE_MS);
  });
}

function rotate(){
  cards.forEach((c,i)=>{
    c.classList.toggle("hidden",!(i>=page*MAX_VISIBLE && i<(page+1)*MAX_VISIBLE));
  });
  page=(page+1)%Math.ceil(cards.length/MAX_VISIBLE);
}

/* ================= INIT ================= */
weather();
loadKPIs();
setInterval(weather,60*60*1000);
setInterval(loadKPIs,60*60*1000);
</script>
</body>
</html>
