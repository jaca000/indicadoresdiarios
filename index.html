<!doctype html>
<html lang="pt-PT">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Monte do Pasto · Painel Vivo</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
html,body{height:100%;margin:0}

/* ================= THEME ================= */
:root{
  --g1:#6fa98c;
  --g2:#4f7f63;
  --b1:#7b6445;

  --glass:rgba(255,255,255,.20);
  --glass2:rgba(0,0,0,.12);
  --stroke:rgba(255,255,255,.25);

  --t1:#f4f6f3;
  --t2:rgba(244,246,243,.80);
  --t3:rgba(244,246,243,.60);

  --r1:18px;
  --r2:26px;
}

body{
  font-family:Inter,system-ui,Arial;
  color:var(--t1);
  overflow:hidden;
  background:
    radial-gradient(1200px 800px at 20% 10%, rgba(255,255,255,.20), transparent 60%),
    radial-gradient(900px 700px at 80% 20%, rgba(200,160,110,.18), transparent 60%),
    radial-gradient(1200px 900px at 60% 90%, rgba(140,220,180,.25), transparent 65%),
    linear-gradient(135deg,var(--g1),var(--g2) 55%,var(--b1));
}

/* ================= FX ================= */
#fx{position:fixed;inset:0;pointer-events:none;z-index:2}
.drop{
  position:absolute;width:2px;height:20px;
  background:rgba(220,245,255,.85);
  border-radius:999px;
  animation:fall linear infinite;
}
@keyframes fall{from{transform:translateY(-120px)}to{transform:translateY(110vh)}}
.fog{
  position:absolute;inset:-20%;
  background:
    radial-gradient(circle at 30% 50%, rgba(255,255,255,.16), transparent 55%),
    radial-gradient(circle at 70% 60%, rgba(255,255,255,.12), transparent 60%);
  animation:fogmove 120s linear infinite;
  opacity:.35;
}
@keyframes fogmove{from{transform:translateX(0)}to{transform:translateX(-14%)}}
.sunGlow{
  position:absolute;top:6%;right:10%;
  width:240px;height:240px;border-radius:50%;
  background:radial-gradient(circle,
    rgba(255,230,170,.85),
    rgba(255,210,150,.32),
    transparent 66%);
  animation:sunpulse 7s ease-in-out infinite;
  opacity:.75;
}
@keyframes sunpulse{0%,100%{transform:scale(.96)}50%{transform:scale(1.03)}}

/* ================= APP ================= */
.app{
  position:relative;z-index:3;height:100vh;
  display:grid;grid-template-rows:90px 1fr 48px;
}

/* ================= HEADER ================= */
header{
  padding:0 24px;
  display:grid;
  grid-template-columns:auto 1fr auto;
  align-items:center;
  gap:16px;
}
.header-left{display:flex;align-items:center;gap:14px}
.logo{height:54px;filter:drop-shadow(0 10px 18px rgba(0,0,0,.18))}
.now{
  display:flex;gap:12px;align-items:center;
  padding:10px 14px;border-radius:var(--r1);
  background:linear-gradient(180deg,var(--glass),var(--glass2));
  border:1px solid var(--stroke);
}
.now .temp{font-size:20px;font-weight:900}
.now .desc{font-size:13px;color:var(--t2)}
.header-mid{display:flex;justify-content:center;gap:14px}
.group{
  display:flex;align-items:center;gap:12px;
  padding:10px 14px;border-radius:var(--r1);
  background:linear-gradient(180deg,var(--glass),var(--glass2));
  border:1px solid var(--stroke);
}
.group-title{font-size:11px;color:var(--t2);text-transform:uppercase}
.pills{display:flex;gap:10px}
.pill{
  display:flex;align-items:center;gap:10px;
  padding:8px 12px;border-radius:16px;
  background:rgba(255,255,255,.22);
  border:1px solid rgba(255,255,255,.18);
}
.pill .big{font-size:15px;font-weight:900}
.pill .sub{font-size:11px;color:var(--t3)}
.clock{
  min-width:120px;text-align:right;
  font-size:28px;font-weight:900;
}

/* ================= ICONS ================= */
.icon{width:26px;height:26px;position:relative}
.icon.sun:before{
  content:"";position:absolute;inset:6px;border-radius:50%;
  background:radial-gradient(circle,#ffe6b4,#ffc36e);
}
.icon.cloud:before{
  content:"";position:absolute;left:3px;right:3px;bottom:7px;height:12px;
  background:#fff;border-radius:999px;
}
.icon.cloud:after{
  content:"";position:absolute;left:6px;bottom:11px;width:12px;height:12px;
  background:#fff;border-radius:50%;box-shadow:10px -2px 0 #fff;
}
.icon.rain:before{
  content:"";position:absolute;left:3px;right:3px;bottom:11px;height:12px;
  background:#fff;border-radius:999px;
}

/* ================= MAIN / KPIs ================= */
main{
  padding:22px 28px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:22px;
  align-items:start;
}
.card{
  background:linear-gradient(180deg,var(--glass),var(--glass2));
  border:1px solid var(--stroke);
  border-radius:var(--r2);
  padding:18px 20px;
  backdrop-filter:blur(10px);
}
.card.hidden{display:none}
.card h3{
  margin:0 0 10px;
  font-size:13px;
  color:var(--t2);
  text-transform:uppercase;
}
.kpi{
  font-size:44px;font-weight:900;line-height:1;
}
.kpi span{font-size:18px;color:var(--t2)}
.kpi-sub{margin-top:8px;font-size:16px;color:var(--t2)}
.kpi-image img{
  width:100%;
  max-height:300px;
  object-fit:contain;
  border-radius:14px;
}

/* ================= FOOTER ================= */
footer{
  padding:0 28px;
  display:flex;align-items:center;
  font-size:14px;color:var(--t2);
}
</style>
</head>

<body>
<div id="fx"></div>

<div class="app">
<header>
  <div class="header-left">
    <img class="logo" src="assets/logo-monte-do-pasto.png">
    <div class="now">
      <div id="nowIcon" class="icon cloud"></div>
      <div>
        <div class="temp" id="nowTemp">--°C</div>
        <div class="desc" id="nowDesc">---</div>
      </div>
    </div>
  </div>

  <div class="header-mid">
    <div class="group"><div class="group-title">Próx. horas</div><div id="hours" class="pills"></div></div>
    <div class="group"><div class="group-title">Próx. dias</div><div id="days" class="pills"></div></div>
  </div>

  <div class="clock" id="clock">--:--</div>
</header>

<main id="kpis"></main>
<footer>Informação interna · Monte do Pasto</footer>
</div>

<script>
/* ================= CONFIG ================= */
const LAT=38.219, LON=-7.887;
const MAX_VISIBLE=6, ROTATE_MS=15000;
const SHEET_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vRcoOLTXvKf6K_4aejdyA7ZK6PObIzqyiLBBOPSehdSkKlxj9_ms0EqJOjT7u2lN11j5DaYIAkcqoy7/pub?output=csv";
const FORECAST_URL=`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true&hourly=temperature_2m,precipitation,weathercode&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`;
const ARCHIVE=`https://archive-api.open-meteo.com/v1/archive?latitude=${LAT}&longitude=${LON}&daily=precipitation_sum&timezone=auto`;

/* ================= CLOCK ================= */
function tick(){const d=new Date();clock.textContent=`${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;}
setInterval(tick,30000);tick();

/* ================= HELPERS ================= */
const isRain=c=>[51,53,55,61,63,65,80,81,82,95,96,99].includes(c);
const icon=c=>isRain(c)?"rain":c===0?"sun":"cloud";

/* ================= WEATHER ================= */
function weather(){
fetch(FORECAST_URL).then(r=>r.json()).then(d=>{
const cw=d.current_weather||{};
nowTemp.textContent=Math.round(cw.temperature)+"°C";
nowDesc.textContent=isRain(cw.weathercode)?"Chuva":cw.weathercode===0?"Sol":"Nublado";
nowIcon.className="icon "+icon(cw.weathercode||3);

hours.innerHTML=""; days.innerHTML="";
for(let i=1;i<=4;i++){
hours.innerHTML+=`<div class="pill"><div class="icon ${icon(d.hourly.weathercode[i])}"></div><div><div class="big">${Math.round(d.hourly.temperature_2m[i])}°</div><div class="sub">${new Date(d.hourly.time[i]).getHours()}h</div></div></div>`;
days.innerHTML+=`<div class="pill"><div class="icon ${icon(d.daily.weathercode[i])}"></div><div><div class="big">${Math.round(d.daily.temperature_2m_max[i])}/${Math.round(d.daily.temperature_2m_min[i])}°</div></div></div>`;
}
});
}

/* ================= RAIN KPI ================= */
function rainKPI(){
const y=new Date().getFullYear();
const end=new Date(); end.setDate(end.getDate()-1);
const fmt=d=>d.toISOString().slice(0,10);
Promise.all([
fetch(`${ARCHIVE}&start_date=${y}-01-01&end_date=${fmt(end)}`).then(r=>r.json()),
fetch(`${ARCHIVE}&start_date=${y-1}-01-01&end_date=${y-1}-${fmt(end).slice(5)}`).then(r=>r.json())
]).then(([a,b])=>{
const sa=a.daily.precipitation_sum.reduce((s,v)=>s+v,0);
const sb=b.daily.precipitation_sum.reduce((s,v)=>s+v,0);
kpis.innerHTML=`
<div class="card kpi-card">
<h3>Chuva acumulada (desde 1 de janeiro)</h3>
<div class="kpi">${Math.round(sa)} <span>L/m²</span></div>
<div class="kpi-sub">${sa-sb>=0?"+":"−"}${Math.abs(Math.round(sa-sb))} L/m² vs ${y-1}</div>
</div>`;
});
}

/* ================= INIT ================= */
weather(); rainKPI();
</script>
</body>
</html>
